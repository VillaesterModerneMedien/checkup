#!/bin/bash

# Funktion zur Verarbeitung der Grep-Ergebnisse
process_grep_results() {
  local grep_command_name="$1"
  local regex="${grep_commands[$grep_command_name]}"
  local exclude_dirs="$2"

  echo "exclude_dirs: $exclude_dirs"
  local matches=$(grep "$regex" "$absolute_path" -riE -C 5 --include=* --color)
  if [ -n "$matches" ]; then
    while IFS= read -r file; do
      local filepath=$(dirname "$file")
      local filename=$(basename "$file")
      if ! is_excluded_directory "$filepath" "$exclude_dirs"; then
        echo "<tr><td class='resultHeadline'>Potenzieller Exploit ($grep_command_name) gefunden: <br><a href=\"file://$filepath\">$filename</a></td>" >> "$tmpfile"
        echo "<td><button class='btn-primary btnCodeview'><i class='bi bi-eye'></i> Code anzeigen</button></td>" >> "$tmpfile"
        echo "<td><button class='btn-secondary openFile'>Open File</button></td></tr>" >> "$tmpfile"
      fi
    done <<< "$matches"
  fi
}
